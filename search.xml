<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>使用 gulp 压缩 Hexo 博客文件（兼容 ES6 标准）</title>
      <link href="//posts/gulp.html"/>
      <url>//posts/gulp.html</url>
      
        <content type="html"><![CDATA[<p>使用文本编辑器打开 Hexo 生成的博客文件，往往会发现其中存在大量的空格与空行，这虽然不影响代码发挥作用，但却会在一定程度上增加文件的大小。</p><p>实际上不止空白，这些由 Hexo 生成的文件中还有很多能够被优化以减小大小的地方，而要提高网站访问速度，减小资源文件的大小一直是最有效的手段之一。</p><p>gulp 是一个自动化构建工具，一般用于开发过程中执行一些常见任务，它有很多社区提供的强大插件可供使用，极大的简化了任务处理流程。在这里我们用它来对 Hexo 生成的博客文件进行压缩优化处理。</p><h2 id="其他教程存在的问题"><a href="#其他教程存在的问题" class="headerlink" title="其他教程存在的问题"></a>其他教程存在的问题</h2><p>使用关键词 <code>hexo gulp</code> 在网上搜索，可以搜到一堆类似的教程，但是根据我的实际测试，网上搜到的这些教程大部分都已经过时了，现在再使用的话或多或少的存在一些问题。</p><p>这些教程中一般都是通过安装 <code>gulp-minify-css</code>、<code>gulp-uglify</code>、<code>gulp-htmlclean</code>、<code>gulp-htmlmin</code> 这几个插件来处理的。下面按照压缩任务划分，分别说明一下现在还按照这些教程操作的话存在的一些问题。</p><h3 id="压缩-CSS-的问题"><a href="#压缩-CSS-的问题" class="headerlink" title="压缩 CSS 的问题"></a>压缩 CSS 的问题</h3><p>上面那几个插件中 <code>gulp-minify-css</code> 是用来压缩 CSS 代码的，使用命令 <code>npm install gulp-minify-css</code> 安装它，此时会发现在该命令的输出中存在如下的一行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm WARN deprecated gulp-minify-css@1.2.4: Please use gulp-clean-css</span><br></pre></td></tr></table></figure><p>说得很明显了，这个插件已弃用，请使用 <code>gulp-clean-css</code> 。这虽然并不影响我们的正常使用该插件，但是有更好的替代品的话为什么还要用这个已弃用的插件呢？</p><h3 id="压缩-JS-的问题"><a href="#压缩-JS-的问题" class="headerlink" title="压缩 JS 的问题"></a>压缩 JS 的问题</h3><p>网上的大部分教程都是使用 <code>gulp-uglify</code> 来压缩 JS 代码，然而这个插件不兼容 JS 的 ES6 标准，导致在我的实际测试中（Hexo 5.x、NexT 8.x）使用该插件时出现了报错，如下所示，最后直接是“无法压缩 JavaScript”：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[19:31:26] &#x27;minify-js&#x27; errored after 489 ms</span><br><span class="line">[19:31:26] GulpUglifyError: unable to minify JavaScript</span><br><span class="line">Caused by: SyntaxError: Unexpected token: punc «)»</span><br><span class="line">File: C:\Users\Administrator\Desktop\hexo\new-blog\public\js\local-search.js</span><br></pre></td></tr></table></figure><p>ES6 标准在2015年6月就正式通过了，现在已经过去了这么久，很多地方都有在使用，而 <code>gulp-uglify</code> 这个插件却完全不兼容，这无疑是个问题。</p><h3 id="压缩-HTML-的问题"><a href="#压缩-HTML-的问题" class="headerlink" title="压缩 HTML 的问题"></a>压缩 HTML 的问题</h3><p>上面提到的插件中 <code>gulp-htmlclean</code> 和 <code>gulp-htmlmin</code> 是用来压缩 HTML 代码的。</p><p>网上教程的一般做法是先将代码传递给 <code>gulp-htmlclean</code> 清理掉其中的空白，然后再传递给 <code>gulp-htmlmin</code> 来移除注释、压缩 HTML 文件中的 CSS、JS 代码等。然而查看 <code>gulp-htmlmin</code> 所基于的 <code>html-minifier</code> 的<a href="https://github.com/kangax/html-minifier#options-quick-reference">文档</a>发现，它有一个 <code>collapseWhitespace</code> 参数，设置为 <code>true</code> 时可以移除 HTML 代码中的空白块，那还多此一举的安装一个 <code>gulp-htmlclean</code> 插件干什么呢？</p><p>另外，上面提到了 <code>gulp-htmlmin</code> 可以压缩 HTML 中的 JS 代码，这个功能用的是跟 <code>gulp-uglify</code> 一样的底层库 <code>uglify-js</code> 来实现的，这也就导致它同样的不兼容 ES6 标准。最终会发现 HTML 文件中的内容并没有被全部压缩成“一行”，仍有部分 JS 代码是以未被压缩的形式存在的。</p><h2 id="我的解决办法"><a href="#我的解决办法" class="headerlink" title="我的解决办法"></a>我的解决办法</h2><p>针对上面那些问题，在一番查找资料与实际测试后，最终还是找到了一些在我看来比较完美的解决办法：</p><ul><li><strong>压缩 CSS：</strong> 这个是最简单的，按照它的提示换成 <code>gulp-clean-css</code> 这个插件就行了。</li><li><strong>压缩 JS：</strong> 针对这个问题网上有一种在我看来比较“邪教”的做法：使用 babel 将 ES6 标准的代码编译为 ES5 标准的代码然后再继续使用 gulp-uglify 进行压缩。怎么说呢，这样做确实是可行的，但就是看着有种不爽的感觉。经过搜索，最后找到了 <code>gulp-uglify-es</code> 这个插件，它将底层库替换成了 <code>terser</code>，可以完美支持 ES6 标准。</li><li><strong>压缩 HTML：</strong> 同样要解决对 ES6 标准支持的问题，最终换到了 <code>gulp-html-minifier-terser</code> 这个插件，它是 <code>gulp-htmlmin</code> 的 fork，但是将底层库换成了 <code>html-minifier-terser</code>（<code>html-minifier</code> 的 fork，将压缩 JS 代码的功能修改为了使用 <code>terser</code> 库处理）。其次就是不再使用 <code>gulp-htmlclean</code> 插件，改为在使用 <code>gulp-html-minifier-terser</code> 插件时传入参数 <code>collapseWhitespace: true</code>。</li></ul><h2 id="操作方法及任务配置"><a href="#操作方法及任务配置" class="headerlink" title="操作方法及任务配置"></a>操作方法及任务配置</h2><p>根据 gulp 及各个插件的文档，我们首先需要全局安装 <code>gulp-cli</code>，然后在博客工作目录下安装需要的插件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --global gulp-cli</span><br><span class="line">npm install gulp gulp-clean-css gulp-uglify-es gulp-html-minifier-terser</span><br></pre></td></tr></table></figure><p>安装完成后在博客工作目录下新建文件 <code>gulpfile.js</code> ，写入如下 gulp 任务配置代码（详细描述见注释）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">const gulp = require(&#x27;gulp&#x27;);</span><br><span class="line">const cleancss = require(&#x27;gulp-clean-css&#x27;);</span><br><span class="line">const uglify = require(&#x27;gulp-uglify-es&#x27;).default;</span><br><span class="line">const htmlmin = require(&#x27;gulp-html-minifier-terser&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 压缩public目录下的css文件</span><br><span class="line">// 可接受参数的文档：https://github.com/jakubpawlowicz/clean-css#constructor-options</span><br><span class="line">gulp.task(&#x27;minify-css&#x27;, () =&gt; &#123;</span><br><span class="line">    return gulp.src(&#x27;./public/**/*.css&#x27;)           // 处理public目录下所有的css文件，下同</span><br><span class="line">        .pipe(cleancss(&#123; compatibility: &#x27;ie8&#x27; &#125;))  // 兼容到IE8</span><br><span class="line">        .pipe(gulp.dest(&#x27;./public&#x27;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 压缩public目录下的js文件</span><br><span class="line">gulp.task(&#x27;minify-js&#x27;, () =&gt; &#123;</span><br><span class="line">    return gulp.src(&#x27;./public/**/*.js&#x27;)</span><br><span class="line">        .pipe(uglify())</span><br><span class="line">        .pipe(gulp.dest(&#x27;./public&#x27;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 压缩public目录下的html文件</span><br><span class="line">// 可接受参数的文档：https://github.com/terser/html-minifier-terser#options-quick-reference</span><br><span class="line">gulp.task(&#x27;minify-html&#x27;, () =&gt; &#123;</span><br><span class="line">    return gulp.src(&#x27;./public/**/*.html&#x27;)</span><br><span class="line">        .pipe(htmlmin(&#123;</span><br><span class="line">            removeComments: true,                 // 移除注释</span><br><span class="line">            removeEmptyAttributes: true,          // 移除值为空的参数</span><br><span class="line">            removeRedundantAttributes: true,      // 移除值跟默认值匹配的属性</span><br><span class="line">            collapseBooleanAttributes: true,      // 省略布尔属性的值</span><br><span class="line">            collapseWhitespace: true,             // 移除空格和空行</span><br><span class="line">            minifyCSS: true,                      // 压缩HTML中的CSS</span><br><span class="line">            minifyJS: true,                       // 压缩HTML中的JS</span><br><span class="line">            minifyURLs: true                      // 压缩HTML中的链接</span><br><span class="line">        &#125;))</span><br><span class="line">        .pipe(gulp.dest(&#x27;./public&#x27;))</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 默认任务，不带任务名运行gulp时执行的任务</span><br><span class="line">gulp.task(&#x27;default&#x27;, gulp.parallel(</span><br><span class="line">    &#x27;minify-css&#x27;, &#x27;minify-js&#x27;, &#x27;minify-html&#x27;</span><br><span class="line">));</span><br></pre></td></tr></table></figure><p>保存之后先用 <code>hexo g</code> 生成博客文件，然后执行命令 <code>gulp</code> 就可以对刚刚生成的博客文件（public 目录下的文件）进行压缩优化处理了。</p>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>全自动化影音系统完整教程（二）qBittorrent增强、docker、emby</title>
      <link href="//posts/qBittorrent.html"/>
      <url>//posts/qBittorrent.html</url>
      
        <content type="html"><![CDATA[<h2 id="文件架构"><a href="#文件架构" class="headerlink" title="文件架构"></a>文件架构</h2><p>放弃了硬链接，因为没有缓存，不想伤害raid 5所有硬盘寿命,并且我的 <em>data</em> 目录是挂载文件服务器上</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">data</span><br><span class="line">├── torrents</span><br><span class="line">│  ├── Movies</span><br><span class="line">│  ├── Series</span><br><span class="line">└── media</span><br><span class="line">   ├── Movies</span><br><span class="line">   ├── Series</span><br></pre></td></tr></table></figure><h3 id="初始创建文件夹及软件配置文件夹"><a href="#初始创建文件夹及软件配置文件夹" class="headerlink" title="初始创建文件夹及软件配置文件夹"></a>初始创建文件夹及软件配置文件夹</h3><h4 id="包括了后期会用到软件文件夹"><a href="#包括了后期会用到软件文件夹" class="headerlink" title="包括了后期会用到软件文件夹"></a>包括了后期会用到软件文件夹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 一级子目录(sonarr,radarr,lidarr,readarr Docker卷)</span></span><br><span class="line"><span class="built_in">mkdir</span> /data/</span><br><span class="line"><span class="comment">## 二级子目录(qbt,emby,bazarr Docker卷)</span></span><br><span class="line"><span class="built_in">mkdir</span> /data/torrents/</span><br><span class="line"><span class="built_in">mkdir</span> /data/media/</span><br><span class="line"><span class="comment">## BT/PT qBittorrent 下载位置</span></span><br><span class="line"><span class="built_in">mkdir</span> /data/torrents/Movies/</span><br><span class="line"><span class="built_in">mkdir</span> /data/torrents/Series/</span><br><span class="line"><span class="built_in">mkdir</span> /data/torrents/Music/</span><br><span class="line"><span class="built_in">mkdir</span> /data/torrents/Books/</span><br><span class="line"><span class="built_in">mkdir</span> /data/torrents/XXX/</span><br><span class="line"><span class="built_in">mkdir</span> /data/torrents/Others/</span><br><span class="line"><span class="comment">## Sonarr Radarr Lidarr Readarr Rootfolder</span></span><br><span class="line"><span class="built_in">mkdir</span> /data/media/Movies/</span><br><span class="line"><span class="built_in">mkdir</span> /data/media/Series/</span><br><span class="line"><span class="comment">## docker挂载以上所有镜像config文件夹</span></span><br><span class="line"><span class="built_in">mkdir</span> /data/media/nginx</span><br><span class="line"><span class="built_in">mkdir</span> /data/media/nginx/sonarr</span><br><span class="line"><span class="built_in">mkdir</span> /data/media/nginx/sonarr/config</span><br><span class="line"><span class="built_in">mkdir</span> /data/media/nginx/radarr</span><br><span class="line"><span class="built_in">mkdir</span> /data/media/nginx/radarr/config</span><br><span class="line"><span class="built_in">mkdir</span> /data/media/nginx/prowlarr</span><br><span class="line"><span class="built_in">mkdir</span> /data/media/nginx/prowlarr/config</span><br><span class="line"><span class="built_in">mkdir</span> /data/media/nginx/bazarr</span><br><span class="line"><span class="built_in">mkdir</span> /data/media/nginx/bazarr/config</span><br><span class="line"><span class="built_in">mkdir</span> /data/media/nginx/chinesesubfinder</span><br><span class="line"><span class="built_in">mkdir</span> /data/media/nginx/chinesesubfinder/app/</span><br><span class="line"><span class="built_in">mkdir</span> /data/media/nginx/chinesesubfinder/app/cache</span><br><span class="line"><span class="built_in">mkdir</span> /data/media/nginx/chinesesubfinder/config</span><br><span class="line"><span class="built_in">mkdir</span> /data/media/nginx/ombi</span><br><span class="line"><span class="built_in">mkdir</span> /data/media/nginx/ombi/config</span><br><span class="line"><span class="built_in">mkdir</span> /data/media/nginx/overseerr</span><br><span class="line"><span class="built_in">mkdir</span> /data/media/nginx/overseerr/config</span><br></pre></td></tr></table></figure><h3 id="安装可能需要的依赖"><a href="#安装可能需要的依赖" class="headerlink" title="安装可能需要的依赖"></a>安装可能需要的依赖</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install xml-twig-tools lsb-release unzip sqlite3 jq sudo -y</span><br></pre></td></tr></table></figure><h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><h3 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apt-get install apt-transport-https ca-certificates curl gnupg-agent software-properties-common -y</span><br><span class="line">apt-key fingerprint 0EBFCD88</span><br><span class="line">curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -</span><br><span class="line">add-apt-repository <span class="string">&quot;deb [arch=amd64] https://download.docker.com/linux/debian <span class="subst">$(lsb_release -cs)</span> stable&quot;</span></span><br><span class="line">apt-get update</span><br><span class="line">apt-get install docker-ce docker-ce-cli containerd.io -y</span><br></pre></td></tr></table></figure><h3 id="安装Docker-compose"><a href="#安装Docker-compose" class="headerlink" title="安装Docker-compose"></a>安装Docker-compose</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dockerver=$(curl --retry 5 -s <span class="string">&quot;https://api.github.com/repos/docker/compose/releases/latest&quot;</span> | grep <span class="string">&#x27;&quot;tag_name&quot;:&#x27;</span> | sed -E <span class="string">&#x27;s/.*&quot;([^&quot;]+)&quot;.*/\1/&#x27;</span>) </span><br><span class="line">sudo curl --retry 5 -L <span class="string">&quot;https://github.com/docker/compose/releases/download/<span class="variable">$&#123;dockerver&#125;</span>/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose</span><br><span class="line">sudo <span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><h2 id="Emby"><a href="#Emby" class="headerlink" title="Emby"></a>Emby</h2><h3 id="安装emby"><a href="#安装emby" class="headerlink" title="安装emby"></a>安装emby</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt install -y apt-transport-https</span><br><span class="line">curl --retry 5 -LO https://github.com/MediaBrowser/Emby.Releases/releases/download/4.6.7.0/emby-server-deb_4.6.7.0_amd64.deb</span><br><span class="line">dpkg -i emby-server-deb_4.6.7.0_amd64.deb</span><br><span class="line"><span class="built_in">rm</span> emby-server-deb_4.6.7.0_amd64.deb</span><br></pre></td></tr></table></figure><h2 id="qBittorrent"><a href="#qBittorrent" class="headerlink" title="qBittorrent"></a>qBittorrent</h2><h3 id="安装-qBittorrent-加强版"><a href="#安装-qBittorrent-加强版" class="headerlink" title="安装 qBittorrent 加强版"></a>安装 qBittorrent 加强版</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /root/qbt</span><br><span class="line"><span class="built_in">cd</span> /root/qbt</span><br><span class="line">qbtver=$(curl --retry 5 -s <span class="string">&quot;https://api.github.com/repos/c0re100/qBittorrent-Enhanced-Edition/releases/latest&quot;</span> | grep <span class="string">&#x27;&quot;tag_name&quot;:&#x27;</span> | sed -E <span class="string">&#x27;s/.*&quot;([^&quot;]+)&quot;.*/\1/&#x27;</span>)</span><br><span class="line">curl --retry 5 -LO https://github.com/c0re100/qBittorrent-Enhanced-Edition/releases/download/<span class="variable">$&#123;qbtver&#125;</span>/qbittorrent-enhanced-nox_x86_64-linux-musl_static.zip</span><br><span class="line">unzip -o qb*.zip</span><br><span class="line"><span class="built_in">rm</span> qb*.zip</span><br><span class="line"><span class="built_in">cp</span> -f qb* /usr/bin/</span><br><span class="line"><span class="built_in">chmod</span> +x /usr/bin/qbittorrent-nox</span><br><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line"><span class="built_in">rm</span> -rf /root/qbt</span><br></pre></td></tr></table></figure><h3 id="配置开机自启"><a href="#配置开机自启" class="headerlink" title="配置开机自启"></a>配置开机自启</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">  <span class="built_in">cat</span> &gt; <span class="string">&#x27;/etc/systemd/system/qbittorrent.service&#x27;</span> &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=qBittorrent Daemon Service</span></span><br><span class="line"><span class="string">Documentation=https://github.com/c0re100/qBittorrent-Enhanced-Edition</span></span><br><span class="line"><span class="string">Wants=network-online.target</span></span><br><span class="line"><span class="string">After=network-online.target nss-lookup.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=simple</span></span><br><span class="line"><span class="string">User=root</span></span><br><span class="line"><span class="string">RemainAfterExit=yes</span></span><br><span class="line"><span class="string">ExecStart=/usr/bin/qbittorrent-nox --profile=/usr/share/nginx/</span></span><br><span class="line"><span class="string">TimeoutStopSec=infinity</span></span><br><span class="line"><span class="string">LimitNOFILE=65536</span></span><br><span class="line"><span class="string">Restart=always</span></span><br><span class="line"><span class="string">RestartSec=3s</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h3 id="重启systemctl并运行qBittorrent服务"><a href="#重启systemctl并运行qBittorrent服务" class="headerlink" title="重启systemctl并运行qBittorrent服务"></a>重启systemctl并运行qBittorrent服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> qbittorrent.service</span><br></pre></td></tr></table></figure><h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><h4 id="显示peer国旗"><a href="#显示peer国旗" class="headerlink" title="显示peer国旗"></a>显示peer国旗</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /data/media/nginx/qBittorrent/</span><br><span class="line"><span class="built_in">mkdir</span> /data/media/nginx/qBittorrent/data/</span><br><span class="line"><span class="built_in">mkdir</span> /data/media/nginx/qBittorrent/data/GeoIP/</span><br><span class="line"><span class="built_in">cd</span> /data/media/nginx/qBittorrent/data/GeoIP/</span><br><span class="line">curl -LO --progress-bar https://raw.githubusercontent.com/johnrosen1/vpstoolbox/master/binary/GeoLite2-Country.mmdb</span><br><span class="line">systemctl restart qbittorrent</span><br></pre></td></tr></table></figure><h4 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h4><p>可能部分机器需要分开输入，会因为操作频繁拒绝服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">cpu_thread_count=$(<span class="built_in">nproc</span> --all)</span><br><span class="line">io_thread=$((<span class="variable">$&#123;cpu_thread_count&#125;</span>*<span class="number">4</span>))</span><br><span class="line">qbtcookie=$(curl -i --header <span class="string">&#x27;Referer: http://127.0.0.1:8080&#x27;</span> --data <span class="string">&#x27;username=admin&amp;password=adminadmin&#x27;</span> http://127.0.0.1:8080/api/v2/auth/login | grep -i set-cookie | <span class="built_in">cut</span> -c13-48)</span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22auto_delete_mode%22:1%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22async_io_threads%22:<span class="variable">$&#123;io_thread&#125;</span>%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22preallocate_all%22:<span class="literal">true</span>%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22customize_trackers_list_url%22:%22https:%2f%2ftrackerslist.com%2fall.txt%22%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22auto_update_trackers_enabled%22:<span class="literal">true</span>%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22idn_support_enabled%22:<span class="literal">true</span>%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22enable_multi_connections_from_same_ip%22:<span class="literal">true</span>%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22add_trackers_enabled%22:<span class="literal">true</span>%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22announce_to_all_tiers%22:<span class="literal">true</span>%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22announce_to_all_trackers%22:<span class="literal">true</span>%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22announce_to_all_trackers%22:<span class="literal">true</span>%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22limit_utp_rate%22:<span class="literal">true</span>%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22limit_tcp_overhead%22:<span class="literal">true</span>%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22limit_lan_peers%22:<span class="literal">false</span>%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22enable_os_cache%22:<span class="literal">false</span>%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22alternative_webui_enabled%22:<span class="literal">false</span>%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22web_ui_upnp%22:<span class="literal">false</span>%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22alternative_webui_path%22:%22%2fusr%2fshare%2fnginx%2fqBittorrent%2fweb%2f%22%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22max_connec%22:-1%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22max_connec_per_torrent%22:-1%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22web_ui_address%22:%22127.0.0.1%22%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22validate_https_tracker_certificate%22:<span class="literal">false</span>%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22peer_tos%22:0%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><h4 id="设置分类及下载位置"><a href="#设置分类及下载位置" class="headerlink" title="设置分类及下载位置"></a>设置分类及下载位置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST -F <span class="string">&#x27;category=Series&#x27;</span> -F <span class="string">&#x27;savePath=/data/torrents/Series/&#x27;</span> http://127.0.0.1:8080/api/v2/torrents/createCategory --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl -X POST -F <span class="string">&#x27;category=Movies&#x27;</span> -F <span class="string">&#x27;savePath=/data/torrents/Movies/&#x27;</span> http://127.0.0.1:8080/api/v2/torrents/createCategory --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><h4 id="设置自动管理分类及默认下载位置"><a href="#设置自动管理分类及默认下载位置" class="headerlink" title="设置自动管理分类及默认下载位置"></a>设置自动管理分类及默认下载位置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22auto_tmm_enabled%22:<span class="literal">true</span>%7D  --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br><span class="line">curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22save_path%22:%22%2fdata%2fmedia%2f%22%7D --cookie <span class="string">&quot;<span class="variable">$&#123;qbtcookie&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><h2 id="检查-qBittorrent-配置"><a href="#检查-qBittorrent-配置" class="headerlink" title="检查 qBittorrent 配置"></a>检查 qBittorrent 配置</h2><p>逐一检查配置是否正确</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>PVE LXC挂载群晖共享文件夹</title>
      <link href="//posts/pve8lxc.html"/>
      <url>//posts/pve8lxc.html</url>
      
        <content type="html"><![CDATA[<h2 id="操作环境："><a href="#操作环境：" class="headerlink" title="操作环境："></a>操作环境：</h2><p>pve下lxc ubuntu 20.04<br>黑群晖nas</p><h2 id="群晖进行操作："><a href="#群晖进行操作：" class="headerlink" title="群晖进行操作："></a>群晖进行操作：</h2><p>打开相关共享权限<br>打开控制面板<br>共享文件夹<br>编辑需要共享的文件夹<br>nfs权限<br>添加pve-ubuntu 的ip地址<br>允许用户访问已装载的子文件夹</p><p><img src="." alt="top"></p><h2 id="Ubuntu操作："><a href="#Ubuntu操作：" class="headerlink" title="Ubuntu操作："></a>Ubuntu操作：</h2><h3 id="Ubuntu安装nfs客户端软件"><a href="#Ubuntu安装nfs客户端软件" class="headerlink" title="Ubuntu安装nfs客户端软件"></a>Ubuntu安装nfs客户端软件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install nfs-common</span><br></pre></td></tr></table></figure><h3 id="创建挂载路径"><a href="#创建挂载路径" class="headerlink" title="创建挂载路径"></a>创建挂载路径</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /home/data/</span><br></pre></td></tr></table></figure><h3 id="挂载群晖相关路径"><a href="#挂载群晖相关路径" class="headerlink" title="挂载群晖相关路径"></a>挂载群晖相关路径</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mount -t nfs 192.168.2.248:/volume3/Download/data /home/data/</span><br></pre></td></tr></table></figure><h3 id="将文件挂载加入开机自启项目"><a href="#将文件挂载加入开机自启项目" class="headerlink" title="将文件挂载加入开机自启项目"></a>将文件挂载加入开机自启项目</h3><p>创建启动脚本<br>路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /home/nfs.sh</span><br></pre></td></tr></table></figure><p>内容如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">\<span class="comment">#!/bin/bash</span></span><br><span class="line">sudo mount -t nfs 192.168.2.248:/volume3/Download/data /home/data/</span><br></pre></td></tr></table></figure><p>赋予脚本可执行权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x /home/nfs.sh</span><br></pre></td></tr></table></figure><p>创建启动文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/systemd/user/user-defined.service</span><br></pre></td></tr></table></figure><p>文件内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">After=network.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/home/nfs.sh</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=default.target</span><br></pre></td></tr></table></figure><p>其中，After 表示服务何时启动，After=network.service 表示网络连接完成后，启动我们的服务；ExecStart 表示我们的脚本（步骤 1 中的 nfs.sh) 的路径；WantedBy 默认填 default.target。</p><h3 id="添加权限"><a href="#添加权限" class="headerlink" title="添加权限"></a>添加权限</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> 744 /home/nfs.sh</span><br><span class="line">sudo <span class="built_in">chmod</span> 664 /etc/systemd/user/user-defined.service</span><br></pre></td></tr></table></figure><p>重新加载系统的 systemd 服务文件，并启用我们自己写的 user-defined.service 文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">systemctl --user <span class="built_in">enable</span> user-defined.service</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> pve </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>全自动化影音系统完整教程（一）Nginx</title>
      <link href="//posts/nginx.html"/>
      <url>//posts/nginx.html</url>
      
        <content type="html"><![CDATA[<h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><p>端口号太多不方便记忆</p><h3 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install ca-certificates lsb-release -y</span><br><span class="line">apt-get install gnupg2 -y</span><br><span class="line">apt-get install nginx -y</span><br><span class="line">apt-get install nano vim -y</span><br></pre></td></tr></table></figure><h3 id="配置开机自启"><a href="#配置开机自启" class="headerlink" title="配置开机自启"></a>配置开机自启</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> /etc/apt/sources.list.d/nginx.list</span><br><span class="line">  <span class="built_in">cat</span> &gt; <span class="string">&#x27;/etc/apt/sources.list.d/nginx.list&#x27;</span> &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">deb https://nginx.org/packages/mainline/debian/ $(lsb_release -cs) nginx</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">  curl -fsSL https://nginx.org/keys/nginx_signing.key | apt-key add -</span><br><span class="line">  apt-get update</span><br><span class="line">  apt-get install nginx -y</span><br><span class="line">  <span class="built_in">cat</span> &gt; <span class="string">&#x27;/lib/systemd/system/nginx.service&#x27;</span> &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=The NGINX HTTP and reverse proxy server</span></span><br><span class="line"><span class="string">Before=netdata.service trojan.service</span></span><br><span class="line"><span class="string">After=syslog.target network.target remote-fs.target nss-lookup.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=forking</span></span><br><span class="line"><span class="string">PIDFile=/run/nginx.pid</span></span><br><span class="line"><span class="string">ExecStartPre=/usr/sbin/nginx -t</span></span><br><span class="line"><span class="string">ExecStart=/usr/sbin/nginx</span></span><br><span class="line"><span class="string">ExecReload=/usr/sbin/nginx -s reload</span></span><br><span class="line"><span class="string">ExecStop=/bin/kill -s QUIT \$MAINPID</span></span><br><span class="line"><span class="string">PrivateTmp=true</span></span><br><span class="line"><span class="string">LimitNOFILE=65536</span></span><br><span class="line"><span class="string">Restart=always</span></span><br><span class="line"><span class="string">RestartSec=3s</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure><h3 id="配置NGINX主配置文件"><a href="#配置NGINX主配置文件" class="headerlink" title="配置NGINX主配置文件"></a>配置NGINX主配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">  <span class="built_in">cat</span> &gt; <span class="string">&#x27;/etc/nginx/nginx.conf&#x27;</span> &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">user nginx;</span></span><br><span class="line"><span class="string">worker_processes auto;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">error_log /var/log/nginx/error.log warn;</span></span><br><span class="line"><span class="string">pid /run/nginx.pid;</span></span><br><span class="line"><span class="string">include /etc/nginx/modules-enabled/*.conf;</span></span><br><span class="line"><span class="string">events &#123;</span></span><br><span class="line"><span class="string">  worker_connections 65536;</span></span><br><span class="line"><span class="string">  use epoll;</span></span><br><span class="line"><span class="string">  multi_accept on;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">http &#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  autoindex_exact_size off;</span></span><br><span class="line"><span class="string">  http2_push_preload on;</span></span><br><span class="line"><span class="string">  aio threads;</span></span><br><span class="line"><span class="string">  charset UTF-8;</span></span><br><span class="line"><span class="string">  tcp_nodelay on;</span></span><br><span class="line"><span class="string">  tcp_nopush on;</span></span><br><span class="line"><span class="string">  server_tokens off;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  proxy_intercept_errors on;</span></span><br><span class="line"><span class="string">  proxy_http_version 1.1;</span></span><br><span class="line"><span class="string">  proxy_ssl_protocols TLSv1.2 TLSv1.3;</span></span><br><span class="line"><span class="string">  proxy_set_header Host \$http_host;</span></span><br><span class="line"><span class="string">  proxy_set_header X-Real-IP \$remote_addr;</span></span><br><span class="line"><span class="string">  proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  include /etc/nginx/mime.types;</span></span><br><span class="line"><span class="string">  default_type application/octet-stream;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  access_log /var/log/nginx/access.log;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  log_format  main  &#x27;\$remote_addr - \$remote_user [\$time_local] &quot;\$request&quot; &#x27;</span></span><br><span class="line"><span class="string">    &#x27;\$status \$body_bytes_sent &quot;\$http_referer&quot; &#x27;</span></span><br><span class="line"><span class="string">    &#x27;&quot;\$http_user_agent&quot; &quot;\$http_x_forwarded_for&quot;&#x27;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  sendfile on;</span></span><br><span class="line"><span class="string">  gzip on; # 本地Nas可以考虑把这个关掉节省CPU资源</span></span><br><span class="line"><span class="string">  gzip_proxied any;</span></span><br><span class="line"><span class="string">  gzip_types *;</span></span><br><span class="line"><span class="string">  gzip_comp_level 1;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  include /etc/nginx/conf.d/default.conf;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h3 id="启动Nginx"><a href="#启动Nginx" class="headerlink" title="启动Nginx"></a>启动Nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> nginx --now</span><br></pre></td></tr></table></figure><h3 id="配置子目录以及反向代理"><a href="#配置子目录以及反向代理" class="headerlink" title="配置子目录以及反向代理"></a>配置子目录以及反向代理</h3><h4 id="新建NGINX配置"><a href="#新建NGINX配置" class="headerlink" title="新建NGINX配置"></a>新建NGINX配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> /etc/nginx/conf.d/*.conf <span class="comment"># 删除旧配置</span></span><br><span class="line"><span class="built_in">touch</span> /etc/nginx/conf.d/default.conf</span><br></pre></td></tr></table></figure><h4 id="写入新配置"><a href="#写入新配置" class="headerlink" title="写入新配置"></a>写入新配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/nginx/conf.d/default.conf</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80 fastopen=20 reuseport default_server so_keepalive=on;</span><br><span class="line">  server_name _;</span><br><span class="line">  location / &#123;</span><br><span class="line">    root /usr/share/nginx/html/;</span><br><span class="line">  &#125;</span><br><span class="line">    location /qbt/ &#123;</span><br><span class="line">        <span class="comment">#access_log off;</span></span><br><span class="line">        proxy_pass              http://127.0.0.1:8080/;</span><br><span class="line">        proxy_set_header        X-Forwarded-Host        <span class="variable">$http_host</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    location /emby/ &#123;</span><br><span class="line">        <span class="comment">#access_log off;</span></span><br><span class="line">        proxy_pass http://127.0.0.1:8096/;</span><br><span class="line">        proxy_pass_request_headers on;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Host <span class="variable">$http_host</span>;</span><br><span class="line">        proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        proxy_set_header Connection <span class="variable">$http_connection</span>;</span><br><span class="line">        proxy_buffering off;</span><br><span class="line">        &#125;</span><br><span class="line">    location /sonarr/ &#123;</span><br><span class="line">        <span class="comment">#access_log off;</span></span><br><span class="line">        proxy_pass http://127.0.0.1:8989/sonarr/;</span><br><span class="line">        proxy_pass_request_headers on;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Host <span class="variable">$http_host</span>;</span><br><span class="line">        proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        proxy_set_header Connection <span class="variable">$http_connection</span>;</span><br><span class="line">        <span class="comment">#proxy_buffering off;</span></span><br><span class="line">        &#125;</span><br><span class="line">    location /radarr/ &#123;</span><br><span class="line">        <span class="comment">#access_log off;</span></span><br><span class="line">        proxy_pass http://127.0.0.1:7878/radarr/;</span><br><span class="line">        proxy_pass_request_headers on;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Host <span class="variable">$http_host</span>;</span><br><span class="line">        proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        proxy_set_header Connection <span class="variable">$http_connection</span>;</span><br><span class="line">        <span class="comment">#proxy_buffering off;</span></span><br><span class="line">        &#125;</span><br><span class="line">    location /lidarr/ &#123;</span><br><span class="line">        <span class="comment">#access_log off;</span></span><br><span class="line">        proxy_pass http://127.0.0.1:8686/lidarr/;</span><br><span class="line">        proxy_pass_request_headers on;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Host <span class="variable">$http_host</span>;</span><br><span class="line">        proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        proxy_set_header Connection <span class="variable">$http_connection</span>;</span><br><span class="line">        <span class="comment">#proxy_buffering off;</span></span><br><span class="line">        &#125;</span><br><span class="line">    location /readarr/ &#123;</span><br><span class="line">        <span class="comment">#access_log off;</span></span><br><span class="line">        proxy_pass http://127.0.0.1:8787/readarr/;</span><br><span class="line">        proxy_pass_request_headers on;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Host <span class="variable">$http_host</span>;</span><br><span class="line">        proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        proxy_set_header Connection <span class="variable">$http_connection</span>;</span><br><span class="line">        <span class="comment">#proxy_buffering off;</span></span><br><span class="line">        &#125;</span><br><span class="line">    location /bazarr/ &#123;</span><br><span class="line">        <span class="comment">#access_log off;</span></span><br><span class="line">        proxy_pass http://127.0.0.1:6767/bazarr/;</span><br><span class="line">        proxy_pass_request_headers on;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Host <span class="variable">$http_host</span>;</span><br><span class="line">        proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        proxy_set_header Connection <span class="variable">$http_connection</span>;</span><br><span class="line">        <span class="comment">#proxy_buffering off;</span></span><br><span class="line">        &#125;</span><br><span class="line">    location /chinesesubfinder/ &#123;</span><br><span class="line">        <span class="comment">#access_log off;</span></span><br><span class="line">        proxy_pass http://127.0.0.1:19035/;</span><br><span class="line">        proxy_pass_request_headers on;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Host <span class="variable">$http_host</span>;</span><br><span class="line">        proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        proxy_set_header Connection <span class="variable">$http_connection</span>;</span><br><span class="line">        <span class="comment">#proxy_buffering off;</span></span><br><span class="line">        &#125;</span><br><span class="line">    location /prowlarr/ &#123;</span><br><span class="line">        <span class="comment">#access_log off;</span></span><br><span class="line">        proxy_pass http://127.0.0.1:9696/prowlarr/;</span><br><span class="line">        proxy_pass_request_headers on;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Host <span class="variable">$http_host</span>;</span><br><span class="line">        proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        proxy_set_header Connection <span class="variable">$http_connection</span>;</span><br><span class="line">        <span class="comment">#proxy_buffering off;</span></span><br><span class="line">        &#125;</span><br><span class="line">    location /jackett/ &#123;</span><br><span class="line">        <span class="comment">#access_log off;</span></span><br><span class="line">        proxy_pass http://127.0.0.1:9117/jackett/;</span><br><span class="line">        proxy_pass_request_headers on;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Host <span class="variable">$http_host</span>;</span><br><span class="line">        proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        proxy_set_header Connection <span class="variable">$http_connection</span>;</span><br><span class="line">        <span class="comment">#proxy_buffering off;</span></span><br><span class="line">        &#125;</span><br><span class="line">    location /ombi/ &#123;</span><br><span class="line">        <span class="comment">#access_log off;</span></span><br><span class="line">        proxy_pass http://127.0.0.1:3579/ombi/;</span><br><span class="line">        proxy_pass_request_headers on;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Host <span class="variable">$http_host</span>;</span><br><span class="line">        proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        proxy_set_header Connection <span class="variable">$http_connection</span>;</span><br><span class="line">        <span class="comment">#proxy_buffering off;</span></span><br><span class="line">        &#125;</span><br><span class="line">    location /nzbget/ &#123;</span><br><span class="line">        <span class="comment">#access_log off;</span></span><br><span class="line">        proxy_pass http://127.0.0.1:6789/;</span><br><span class="line">        proxy_pass_request_headers on;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Host <span class="variable">$http_host</span>;</span><br><span class="line">        proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        proxy_set_header Connection <span class="variable">$http_connection</span>;</span><br><span class="line">        <span class="comment">#proxy_buffering off;</span></span><br><span class="line">        &#125;</span><br><span class="line">    location /overseerr/ &#123;</span><br><span class="line">        <span class="comment">#access_log off;</span></span><br><span class="line">        proxy_pass http://127.0.0.1:5055/;</span><br><span class="line">        proxy_pass_request_headers on;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Host <span class="variable">$http_host</span>;</span><br><span class="line">        proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        proxy_set_header Connection <span class="variable">$http_connection</span>;</span><br><span class="line">        <span class="comment">#proxy_buffering off;</span></span><br><span class="line">        &#125;</span><br><span class="line">    location /rsshub/ &#123;</span><br><span class="line">        proxy_redirect off;</span><br><span class="line">        proxy_pass http://127.0.0.1:1200/;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="修改NGINX默认前端页面以方便进入"><a href="#修改NGINX默认前端页面以方便进入" class="headerlink" title="修改NGINX默认前端页面以方便进入"></a>修改NGINX默认前端页面以方便进入</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /usr/share/nginx/html/index.html</span><br></pre></td></tr></table></figure><h4 id="写入以下配置-替换192-168-2-237为自己ip"><a href="#写入以下配置-替换192-168-2-237为自己ip" class="headerlink" title="写入以下配置(替换192.168.2.237为自己ip)"></a>写入以下配置(替换192.168.2.237为自己ip)</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">html</span> &#123; <span class="attribute">color</span>-scheme: light dark; &#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-tag">body</span> &#123; <span class="attribute">width</span>: <span class="number">35em</span>; <span class="attribute">margin</span>: <span class="number">0</span> auto;</span></span><br><span class="line"><span class="language-css"><span class="attribute">font-family</span>: Tahoma, Verdana, Arial, sans-serif; &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h</span>&gt;</span>前端<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://192.168.2.237:80/emby/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;noreferrer&quot;</span>&gt;</span>emby<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://192.168.2.237:80/ombi/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;noreferrer&quot;</span>&gt;</span>ombi<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://192.168.2.237:80/overseerr/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;noreferrer&quot;</span>&gt;</span>overseerr<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>中间层<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://192.168.2.237:80/sonarr/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;noreferrer&quot;</span>&gt;</span>sonarr<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://192.168.2.237:80/radarr/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;noreferrer&quot;</span>&gt;</span>radarr<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://192.168.2.237:80/lidarr/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;noreferrer&quot;</span>&gt;</span>lidarr<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://192.168.2.237:80/readarr/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;noreferrer&quot;</span>&gt;</span>readarr<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>字幕<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://192.168.2.237:80/bazarr/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;noreferrer&quot;</span>&gt;</span>bazarr<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://192.168.2.237:80/chinesesubfinder/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;noreferrer&quot;</span>&gt;</span>chinesesubfinder<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>索引器<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://192.168.2.237:80/prowlarr/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;noreferrer&quot;</span>&gt;</span>prowlarr<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://192.168.2.237:80/jackett/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;noreferrer&quot;</span>&gt;</span>jackett<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://192.168.2.237:80/rsshub/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;noreferrer&quot;</span>&gt;</span>rsshub<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>下载器<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://192.168.2.237:80/qbt/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;noreferrer&quot;</span>&gt;</span>qbt<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://192.168.2.237:80/nzbget/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;noreferrer&quot;</span>&gt;</span>nzbget<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>For online documentation and support please refer to</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://nginx.org/&quot;</span>&gt;</span>nginx.org<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">Commercial support is available at</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://nginx.com/&quot;</span>&gt;</span>nginx.com<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>Thank you for using nginx.<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="使配置生效"><a href="#使配置生效" class="headerlink" title="使配置生效"></a>使配置生效</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -t &amp;&amp; nginx -s reload</span><br></pre></td></tr></table></figure><p>参考资料：</p><p><a href="https://wp.gxnas.com/11923.html">懒人党的福音：顶级全自动化影音系统全方位深入剖析</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>PVE小技巧合集</title>
      <link href="//posts/pveproblem.html"/>
      <url>//posts/pveproblem.html</url>
      
        <content type="html"><![CDATA[<h3 id="删除多余内核"><a href="#删除多余内核" class="headerlink" title="删除多余内核"></a>删除多余内核</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uname</span> -sr</span><br><span class="line">dpkg --list|grep pve-kernel</span><br><span class="line">apt purge pve-kernel-****-pve</span><br></pre></td></tr></table></figure><h2 id="修改-Proxmox-VE-6-0-LVM-Thin-为存储分区"><a href="#修改-Proxmox-VE-6-0-LVM-Thin-为存储分区" class="headerlink" title="修改 Proxmox VE 6.0 LVM Thin 为存储分区"></a>修改 Proxmox VE 6.0 LVM Thin 为存储分区</h2><h3 id="1-修改存储配置文件"><a href="#1-修改存储配置文件" class="headerlink" title="1.修改存储配置文件"></a>1.修改存储配置文件</h3><p>文件为 /etc/pve 目录下的 storage.cfg，执行指令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/pve/</span><br><span class="line"><span class="comment"># 备份原文件</span></span><br><span class="line"><span class="built_in">cp</span> storage.cfg storage.cfg.bak</span><br><span class="line"><span class="comment"># 修改文件</span></span><br><span class="line">vim storage.cfg</span><br><span class="line"><span class="comment"># 删除 lvmthin: local-lvm 部分，/var/lib/vz部分如下：</span></span><br><span class="line"><span class="built_in">dir</span>: <span class="built_in">local</span></span><br><span class="line">        path /var/lib/vz</span><br><span class="line">        content rootdir,iso,vztmpl,backup</span><br></pre></td></tr></table></figure><h3 id="2-转换-LVM-Thin-分区格式并挂载"><a href="#2-转换-LVM-Thin-分区格式并挂载" class="headerlink" title="2.转换 LVM Thin 分区格式并挂载"></a>2.转换 LVM Thin 分区格式并挂载</h3><p>移除 LVM Thin</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lvremove /dev/pve/data</span><br></pre></td></tr></table></figure><p>查看空闲容量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgdisplay pve | grep Free</span><br></pre></td></tr></table></figure><p>之后会有类似 <em>Free PE / Size [number] / [number]</em> 的输出，记录 Size 后的数字</p><p>新建 LVM</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># [number] 填写上一步记录的数字</span></span><br><span class="line">lvcreate -l [number] -n data pve</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># LVM Thin 分区转换为 ext4 格式</span></span><br><span class="line">mkfs.ext4 /dev/pve/data</span><br><span class="line"><span class="comment"># 临时挂载到目录 /mnt/temp</span></span><br><span class="line">mount /dev/pve/data /mnt/temp</span><br><span class="line"><span class="comment"># 将原目录下的文件转移到 LVM Thin 分区</span></span><br><span class="line"><span class="built_in">cp</span> -ri /var/lib/vz/* /mnt/temp</span><br><span class="line"><span class="comment"># 取消挂载 LVM Thin 分区</span></span><br><span class="line">umount /mnt/temp</span><br><span class="line"><span class="comment"># 重新挂载到 /var/lib/vz 目录</span></span><br><span class="line">mount /dev/pve/data /var/lib/vz</span><br></pre></td></tr></table></figure><h3 id="3-修改-fstab-文件永久生效"><a href="#3-修改-fstab-文件永久生效" class="headerlink" title="3.修改 fstab 文件永久生效"></a>3.修改 fstab 文件永久生效</h3><p>修改 /etc/fstab，在 <strong>swap 分区后</strong>添加行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/dev/pve/data /var/lib/vz ext4 defaults 0 0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> pve </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 问题答疑 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo 正确插入图片显示的做法 2022</title>
      <link href="//posts/hexoimportimage.html"/>
      <url>//posts/hexoimportimage.html</url>
      
        <content type="html"><![CDATA[<h3 id="适用版本"><a href="#适用版本" class="headerlink" title="适用版本"></a>适用版本</h3><p><strong>hexo: 6.1.0</strong></p><h3 id="正确姿势："><a href="#正确姿势：" class="headerlink" title="正确姿势："></a>正确姿势：</h3><p>直接修改_config.yml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">post_asset_folder: <span class="literal">true</span></span><br><span class="line">marked:</span><br><span class="line">  prependRoot: <span class="literal">true</span></span><br><span class="line">  postAsset: <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="但为什么还是有人无法正确引用？"><a href="#但为什么还是有人无法正确引用？" class="headerlink" title="但为什么还是有人无法正确引用？"></a>但为什么还是有人无法正确引用？</h3><p>因为渲染器还是指向的绝对引用地址</p><p><strong>hexo-rendered-marked</strong> 罪魁祸首</p><h3 id="安装修改版marked"><a href="#安装修改版marked" class="headerlink" title="安装修改版marked"></a>安装修改版marked</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i https://github.com/Xu-pixel/hexo-renderer-marked</span><br></pre></td></tr></table></figure><h3 id="不要安装hexo-asset-image"><a href="#不要安装hexo-asset-image" class="headerlink" title="不要安装hexo-asset-image"></a>不要安装hexo-asset-image</h3><p><del><code>npm install hexo-asset-image –save</code></del></p><p>Hexo已经支持Markdown语法插入图片了！！<br>Hexo已经支持Markdown语法插入图片了！！<br>Hexo已经支持Markdown语法插入图片了！！<br>网上说hexo不能用Markdown相对引用图片的资料已经过时了！！<br>*IMPORTANT: Unlike the past, Hexo already supports Markdown syntax for inserting images!</p><p>以下摘自官方：<br>The following is the part of official document:</p><blockquote><p>Embedding an image using markdown</p><p>hexo-renderer-marked 3.1.0 introduced a new option that allows you to embed an image in markdown without using asset_img tag plugin.</p><p>To enable:</p><blockquote><p>_config.yml<br>post_asset_folder: true<br>marked:<br>prependRoot: true<br>postAsset: true</p></blockquote><p>Once enabled, an asset image will be automatically resolved to its corresponding post’s path. For example, “image.jpg” is located at “/2020/01/02/foo/image.jpg”, meaning it is an asset image of “/2020/01/02/foo/“ post, <code>![](image.jpg)</code> will be rendered as <code>&lt;img src=&quot;/2020/01/02/foo/image.jpg&quot;&gt;</code>.</p></blockquote><p>所以其实Hexo已经可以不使用繁杂的标签<code>&#123;% asset_img example.jpg This is an example image %&#125;</code>去插入图片了,可以直接使用Markdown语法并进行相对路径引用了，如<code>![](image.jpg)</code>。<br>So actually we don’t need to use the nasty form <code>&#123;% asset_img example.jpg This is an example image %&#125;</code> to insert images. Feel free to use the Markdown way<code>![](image.jpg)</code></p><h3 id="附：永久链接（可随意修改文件名和标题）"><a href="#附：永久链接（可随意修改文件名和标题）" class="headerlink" title="附：永久链接（可随意修改文件名和标题）"></a>附：永久链接（可随意修改文件名和标题）</h3><h4 id="设为日期"><a href="#设为日期" class="headerlink" title="设为日期"></a><strong>设为日期</strong></h4><p>date字段是生成URL的优良种子，我们何不用date直接生成URL呢。想到就做，把站点配置文件_config.yml设置成</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">permalink: :layout/:date.html</span><br></pre></td></tr></table></figure><p>然后执行<code>hexo generate</code>，发现会报错，因为date形如“2021-04-12 13:15:54”，中间有空格。不过这很好解决，参考Hexo的官方文档，设置成这样就可以了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">permalink: :layout/:year:month:day:hour:minute:second.html</span><br></pre></td></tr></table></figure><p>生成的URL如</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.duheweb.com/post/20210412131554.html</span><br></pre></td></tr></table></figure><p>还要注意站点配置文件中的pretty_urls设置是否是这样的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pretty_urls:</span><br><span class="line">  trailing_index: true </span><br><span class="line">  trailing_html: true </span><br></pre></td></tr></table></figure><p>设为false的话，链接就变成了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.duheweb.com/post/20210412131554</span><br></pre></td></tr></table></figure><p>去掉URL末尾的.html，更简洁了。带不带html对SEO收录来说，影响不大，但不带html发外链的时候，有些平台编辑器会自动在URL后面加一个“/ ”造成404页面。所以，最好还是带上html，同时也能给人一种静态页面的安全感。</p>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 搭建教程 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
